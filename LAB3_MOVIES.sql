CREATE DATABASE cs104_movie;
USE cs104_movie;

CREATE TABLE ACTOR(ACT_ID int, ACT_NAME varchar(15), ACT_GENDER char,
PRIMARY KEY(act_id));

CREATE TABLE DIRECTOR(DIR_ID INT, DIR_NAME VARCHAR(15), DIR_PHONE BIGINT, 
PRIMARY KEY(DIR_ID));
ALTER TABLE DIRECTOR MODIFY DIR_NAME VARCHAR(25);

CREATE TABLE MOVIES(MOV_ID INT, MOV_TITLE VARCHAR(15), MOV_YEAR INT, MOV_LANG VARCHAR(10), DIR_ID INT,
PRIMARY KEY(MOV_ID), 
FOREIGN KEY(DIR_ID) REFERENCES DIRECTOR(DIR_ID));

CREATE TABLE MOVIE_CAST(ACT_ID INT, MOV_ID INT, ROLE VARCHAR(15),
PRIMARY KEY(ACT_ID, MOV_ID),
FOREIGN KEY(ACT_ID) REFERENCES ACTOR(ACT_ID),
FOREIGN KEY(MOV_ID) REFERENCES MOVIES(MOV_ID));


CREATE TABLE RATING(MOV_ID INT, REV_STARS INT,
PRIMARY KEY(MOV_ID));

INSERT INTO ACTOR(ACT_ID, ACT_NAME, ACT_GENDER) VALUES 
(301,'ANUSHKA','F'),
(302,'PRABHAS','M'),
(303,'PUNITH','M'),
(304,'JERMY','M');

INSERT INTO DIRECTOR(DIR_ID, DIR_NAME, DIR_PHONE) VALUES 
(60,'RAJAMOULI', 8751611001),
(61,'HITCHCOCK', 7766138911),
(62,'FARAN', 9986776531),
(63,'STEVEN SPIELBERG', 8989776530);


INSERT INTO MOVIES(MOV_ID, MOV_TITLE, MOV_YEAR, MOV_LANG, DIR_ID) VALUES 
(1001,'BAHUBALI-2', 2017, 'TELUGU', 60),
(1002,'BAHUBALI-1', 2015, 'TELUGU', 60),
(1003,'AKASH', 2008, 'KANNADA', 61),
(1004,'WAR HORSE', 2011, 'ENGLISH', 63);


INSERT INTO MOVIE_CAST(ACT_ID, MOV_ID, ROLE) VALUES 
(301, 1002, 'HEROINE'),
(301, 1001, 'HEROINE'),
(303, 1003, 'HERO'),
(303, 1002, 'GUEST'),
(304, 1004, 'HERO');

INSERT INTO RATING(MOV_ID, REV_STARS) VALUES 
(1001, 4),
(1002, 2),
(1003, 5),
(1004, 4);

UPDATE RATING SET REV_STARS=1 WHERE MOV_ID=1004;

#ANSWER NO.1
SELECT MOV_TITLE
FROM MOVIES M, DIRECTOR D
WHERE M.DIR_ID = D.DIR_ID AND D.DIR_NAME = 'HITCHCOCK';

#ANSWER NO.2
SELECT M.MOV_TITLE
FROM MOVIES M, MOVIE_CAST MV
WHERE M.MOV_ID=MV.MOV_ID AND
	ACT_ID IN (SELECT ACT_ID
		   FROM MOVIE_CAST
		   GROUP BY ACT_ID
		   HAVING COUNT(ACT_ID) > 1);
           
#ANSWER NO.3
SELECT ACT_NAME, MOV_TITLE, MOV_YEAR
FROM ACTOR A 
JOIN MOVIE_CAST MC ON A.ACT_ID = MC.ACT_ID 
JOIN MOVIES M ON MC.MOV_ID = M.MOV_ID 
WHERE M.MOV_YEAR NOT BETWEEN 2000 AND 2015;


#ANSWER NO.4
SELECT MOV_TITLE, COUNT(REV_STARS) FROM MOVIES INNER JOIN RATING USING (MOV_ID) GROUP BY MOV_TITLE HAVING MAX(REV_STARS)>0 ORDER BY MOV_TITLE; 

#ANSWER NO.5
UPDATE RATING SET REV_STARS=3 WHERE MOV_ID IN (SELECT MOV_ID FROM MOVIES WHERE DIR_ID IN (SELECT DIR_ID FROM DIRECTOR WHERE DIR_NAME = 'STEVEN SPIELBERG'));
SELECT * FROM RATING;





